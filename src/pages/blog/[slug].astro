---
import Layout from '@/layouts/Layout.astro'
import {template} from '@/settings'
import {getCollection, render} from 'astro:content'
import { Image } from 'astro:assets'

export async function getStaticPaths(): Promise<Array<{ params: { slug: string }, props: { post: any } }>> {
    const blogEntries = await getCollection("blog");

    const posts = blogEntries
        .map(post => {
        const slug = post.id
            return {
            params: { slug },
            props: { post },
            }
    })
    return posts
}
const {post} = Astro.props;
const { title, date, tags, image } = post.data;
const { Content } = await render(post);
const postSlug = post.id;
---

<Layout title={title}>
	<div class='max-w-4xl mx-auto'>
		<!-- Hero image -->
		<div class="relative w-full h-64 md:h-96 mb-8 overflow-hidden rounded-lg shadow-md bg-neutral-100">
			{image ? (
				<img 
					src={image} 
					alt={title} 
					class="w-full h-full object-cover" 
					transition:name={`blog-image-${postSlug}`}
					onerror="this.src='/images/dwb-amsterdam-2024/cover.jpg';"
				/>
			) : (
				<img 
					src="/images/dwb-amsterdam-2024/cover.jpg" 
					alt={title} 
					class="w-full h-full object-cover" 
					transition:name={`blog-image-${postSlug}`}
				/>
			)}
			<div class="absolute inset-0 bg-gradient-to-t from-base-300/70 via-transparent to-transparent"></div>
		</div>
		
		<article class='prose max-w-3xl mx-auto prose-headings:text-base-content prose-p:text-base-content/80'>
			<!-- Header section -->
			<div class='mb-8 border-b pb-8'>
				<h1 class='text-4xl font-bold mb-4 text-base-content' transition:name={`blog-title-${postSlug}`}>{title}</h1>
				<div class='flex flex-col gap-3 text-base-content/70'>
					<!-- Date -->
					<time datetime={date} class='flex items-center'>
						<svg
							xmlns='http://www.w3.org/2000/svg'
							class='h-4 w-4 mr-2'
							fill='none'
							viewBox='0 0 24 24'
							stroke='currentColor'
						>
							<path
								stroke-linecap='round'
								stroke-linejoin='round'
								stroke-width='2'
								d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'
							></path>
						</svg>
						{
							new Date(date).toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})
						}
					</time>

					<!-- Tags -->
					{
						tags && (
							<div class='flex flex-wrap gap-2'>
								{tags.map(tag => (
									<span class='badge badge-primary text-primary-content'>#{tag}</span>
								))}
							</div>
						)
					}
				</div>
			</div>

			<!-- Post content -->
			<div class="mt-8">
				<Content />
			</div>
		</article>
	</div>
</Layout>