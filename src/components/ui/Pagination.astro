---
import { template } from "@/settings"

interface Props {
  page: {
    url: {
      prev: string | undefined;
      next: string | undefined;
      current: string;
    };
    currentPage: number;
    total: number;
    size: number;
  };
  showNumbers?: boolean;
}

const { page, showNumbers = false } = Astro.props;

// Calculate pages to show
const totalPages = Math.ceil(page.total / page.size);
const currentPage = page.currentPage;

// Helper to generate page links
const generatePageUrl = (pageNum: number) => {
  // Implement base URL construction - this could be improved based on actual URL patterns
  if (pageNum === 1) {
    return page.url.current.replace(/\/\d+\/?$/, '');
  }
  return page.url.current.replace(/\/\d+\/?$/, `/${pageNum}`);
};

// Limit number of pages shown for larger sets
let pagesToShow: (number | string)[] = [];
if (totalPages <= 5) {
  // If 5 or fewer pages, show all
  pagesToShow = Array.from({ length: totalPages }, (_, i) => i + 1);
} else {
  // Show 1, current-1, current, current+1, and last page with ellipses as needed
  pagesToShow = [1];
  
  if (currentPage > 3) {
    pagesToShow.push('...');
  }
  
  if (currentPage > 2) {
    pagesToShow.push(currentPage - 1);
  }
  
  if (currentPage !== 1 && currentPage !== totalPages) {
    pagesToShow.push(currentPage);
  }
  
  if (currentPage < totalPages - 1) {
    pagesToShow.push(currentPage + 1);
  }
  
  if (currentPage < totalPages - 2) {
    pagesToShow.push('...');
  }
  
  pagesToShow.push(totalPages);
}
---

<div class="join flex justify-center mt-8">
  {/* Previous button */}
  <a
        href={page.url.prev}
    class:list={["join-item btn btn-sm", { "btn-disabled": !page.url.prev, "btn-primary": page.url.prev }]}
    aria-label="Go to previous page"
  >«</a>

  {/* Numbered pages */}
  {showNumbers && totalPages > 1 && pagesToShow.map((pageNum) => {
    if (pageNum === '...') {
      return <span class="join-item btn btn-sm btn-disabled">...</span>;
    }
    
    const pageNumber = pageNum as number;
    const isCurrentPage = pageNumber === currentPage;
    
    return (
      <a 
        href={isCurrentPage ? undefined : generatePageUrl(pageNumber)}
        class:list={[
          "join-item btn btn-sm", 
          { 
            "btn-primary": isCurrentPage,
            "btn-disabled": isCurrentPage
          }
        ]}
        aria-label={`Go to page ${pageNumber}`}
        aria-current={isCurrentPage ? "page" : undefined}
      >
        {pageNumber}
      </a>
    );
  })}

  {/* Next button */}
  <a
        href={page.url.next}
    class:list={["join-item btn btn-sm", { "btn-disabled": !page.url.next, "btn-primary": page.url.next }]}
    aria-label="Go to next page"
  >»</a>
</div>